{% extends "gaza/layout.html" %}
{% load static %}
{% block title %}
عرض الشكاوى
{% endblock %}
{% block body %}

<div  class="main-content">
    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-body">
                         <h4 class="card-title text-center mb-3">
                          ابحث عن شكوى
                         </h4>
                        
                         <form action="{% url 'case_management:searchPost' %}" method="GET" class="needs-validation" novalidate="">
                            {% csrf_token %}
                          <div class="row">
                           <div class="col-lg-12">
                            <div class="mb-3 ">
                             <div class="d-flex justify-content-center">  
                             <input name="query" dir="rtl" class="form-control " id="validationCustom01" placeholder="ابحث بالعنوان, او اسم المستفيد" required="" type="text">
                            </div> 
                            </div>
                           </div>
                          </div>
                          <div class="d-flex justify-content-center">
                          <button class="btn btn-primary " type="submit">
                            بحث
                          </button>
                        </div>
                         </form>
                        </div>
                       </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                 <div>
                    
                  <div dir="rtl" class="float-end">
                   <form action="{% url 'case_management:getcases' %}" method="POST"  class="d-inline-flex mb-3">
                    {% csrf_token %}
                    <select name="whichCases" onchange="this.form.submit();" class="form-select" id="order-selectinput">
                        <option selected disabled>فلترة بالحالة</option>
                     <option  value="0" >
                      جميع الشكاوى
                     </option>
                     <option value="1">
                      الشكاوى الجديدة
                     </option>
                     <option value="2"  >
                      الشكاوى الجارية
                     </option>
                     <option value="3">
                        الشكاوى المغلقة
                       </option>
                    </select>
                 
                   </form>
                  </div>

                  
                  <a href="{% url 'case_management:addpost'%} ">
                  <button class="btn btn-success waves-effect waves-light mb-3" type="button">
                   <i class="mdi mdi-plus me-1">
                   </i>
                   فتح شكوى جديدة
                  </button>
                  </a>
                 </div>

                 <div dir="rtl" class="table-responsive mb-4">
                  <table class="table table-centered datatable dt-responsive nowrap table-card-list" style="border-collapse: collapse; border-spacing: 0 12px; width: 100%;">
                   <thead>
                    <tr class="bg-transparent">
                     
                     <th>
                      مخلص الشكوى
                     </th>
                     <th>
                      التاريخ 
                     </th>
                     <th>
                      المسؤول
                     </th>
                     <th>
                      الأهمية
                     </th>
                     <th>
                      الحالة
                     </th>
                     <th style="width: 120px;">
                      اسم المستفيد
                     </th>
                    </tr>
                   </thead>
                   <tbody class="table-striped">
                 
                    {% for ticket in tickets %}
                    <tr>
                     <td>
                      <a class="text-dark fw-bold" href="{% url 'case_management:ticket_detail' ticket.id %}">
                       {{ticket.title}}
                      </a>
                     </td>
                     <td>
                      {{ticket.date}}
                     </td>
                     <td>
                      {{ticket.caseResponsible.first_name}}
                     </td>
                     <td>
                        {% if ticket.is_urgent %}
                        <span class="badge bg-danger">
                            عاجلة
                           </span>
                         {% else %}  
                         <span class="badge bg-primary">
                            عادية
                           </span>
                         {% endif %}
                     </td>
                     <td>
                        {% if ticket.status == 'New' %}
                      <div class="badge bg-pill bg-soft-success font-size-12">
                       جديدة
                      </div>
                      {% elif ticket.status == 'Ongoing' %}
                      <div class="badge bg-pill bg-soft-warning font-size-12">
                        جارية
                       </div>
                       {% else %}
                       <div class="badge bg-pill bg-soft-dark font-size-12">
                        مغلقة
                       </div>
                      {% endif %}

                     </td>
                     <td>
                        {{ticket.belongsTo}}
                       </td>
                    </tr>
                    {% endfor %}
                   </tbody>
                  </table>
                 </div>
                 <!-- end table -->
                </div>
               </div>


        </div>
    </div>
</div>

{% endblock %}